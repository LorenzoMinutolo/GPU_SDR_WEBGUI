{% extends "base.html" %}

{% block content %}
<style>
html, body {
  height:92%;
  width: 100%;
  display:flex;
  flex-direction:column;
  align-items: flex-start;
  margin:0px;
}
.container {
  display: flex;
  height: 100%;
  margin:0px;
  width: 100%;
}
body > * {
  flex-shrink: 0;
}
.navigator_1 {
  min-width:250px;
  background-color: #f8f9fa;
  resize: horizontal;
  overflow-y: scroll;
  overflow-x: hidden;
  margin-left:-15px
}
.file_content{
  min-width:900px;
  flex:3;
  width: 100%;
  margin-left:10px;
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 20px;

}

.loader {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  width: 120px;
  height: 120px;
  -webkit-animation: spin 2s linear infinite; /* Safari */
  animation: spin 2s linear infinite;
  display: none;
  margin: auto;

}

/* Safari */
@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

</style>
<script>
var url_plotter = '{{ url_for("plot_serve") }}'
var data_stuct = JSON.parse('{{folder_struct | tojson}}');
var source_table_json = JSON.parse('{{source_files | tojson}}');
var currently_selected = []
</script>

<div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups" style = "margin-bottom:10px !important; margin-left:10px !important;">
  <div class="btn-group mr-3 " role="group" aria-label="First group">
    <center style = "margin-bottom:10px;">
      <h4 href="#" data-toggle="tooltip"title="Action to perform on selected files." >Actions </h4>
    </center>
    <input type="submit" class="btn btn-secondary" name="plot_button" value="Plot" ></input>
    <input type="submit" class="btn btn-secondary" name="analyze_button" value="Analyze"  onclick="configure_analyze_modal()"></input>
    <input type="submit" class="btn btn-secondary" name="export_button" value="Export" ></input>
  </div>
  <div class="btn-group mr-2 " role="group" aria-label="Second group">
    <center style = "margin-bottom:10px;">
      <h4 href="#" data-toggle="tooltip"title="All actions will be performed on these files" > File selector</h4>
    </center>
    <input type="submit" class="btn btn-secondary" name="clear_selected" value="Clear selected" id="clear_selected-file-btn" ></input>
    <input type="submit" class="btn btn-secondary" name="selected_files (0)" value ="Selected files (0)" id="selected-files-btn"  onclick="open_selected_modal();"></input>
  </div>
  <div class="btn-group mr-2 " role="group" aria-label="Third group">
    <center style = "margin-bottom:10px;">
      <h4 href="#" data-toggle="tooltip"title="Various analysis/plots can reference an other file, add the file to this list to use it as reference">Source file selector </h4>
    </center>
    <input type="submit" class="btn btn-secondary" name="export_source" value="Manage sources" data-toggle="modal" data-target="#source-manage-modal" ></input>
    <input type="submit" class="btn btn-secondary" name="manage_source" value="Add to source" onclick = "add_source_file_prompt()"></input>
  </div>
</div>


<div class="container">
  <div class="navigator_1">
    <div style="margin:10px" id = "file_tree_container">
    <input id="file_tree_search" type="text" placeholder="search folders..." style="margin:10px" />
    <b data-toggle="tooltip" title="Load also files in the subfolders of selected node">Recursive loading: </b>
    <input type="checkbox" id = 'recursive_file_loading_chk'/>
    </div>
    <div id = "file_tree"></div>
  </div>
  <div class="file_content" id="file_table_container">
    <table id="file_selector_table" class="table" width="100%">
      <thead>
         <tr>
            <th>Db</th>
            <th>Plot</th>
            <th>File</th>
            <th>Size</th>
            <th>Kind</th>
            <th>Parent</th>
            <th>Select</th>
         </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="loader" id='loader'></div>
  </div>
</div>

<!-- PLOT DISPLAY PART -->

<!-- This is quite intricated: the jinja2 templating engine is generating a modal form and its load script on a per file basis -->
<!-- Modal -->
<div class="modal fade" id="modal_plot_select" role="dialog">
  <div class="modal-dialog" style = "width: auto; max-width: 960px;">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header" style="padding:20px 20px;">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4><span class="glyphicon glyphicon-picture"></span> Available plots</h4>
        List of the available plots for: <b id='plot_measure_name'></b><br>
        <i> Kind field tells if the plot involves also other measures.</i>
      </div>
      <div class="modal-body" style="padding:40px 50px; ">
        <table id="plot_select_table" class="table" style="width:95%">
          <thead>
            <tr>
              <th>Plot</th>
              <th>Kind</th>
              <th>Generated</th>
              <th>Comment</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<!-- SELECTED FILE PART -->
<div class="modal fade" id="selected-files-modal" role="dialog">
  <div class="modal-dialog" style = "width: auto; max-width: 960px;">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header" style="padding:20px 20px;">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4><span class="glyphicon glyphicon-plus"></span> Selected files</h4>
        List of the files selected for operations
      </div>
        <div class="modal-body" style="padding:40px 50px; ">

          <table class="table" id = "selected_files-table">
            <thead>
              <tr>
                <th>#</th>
                <th>File selected</th>
                <th>Parent</th>
              </tr>
            </thead>

            <tbody id="selected_files_list"></tbody>
          </table>

      </div>
    </div>
  </div>
</div>

<!-- SOURCE FILE PART -->
<div class="modal fade" id="source-files-modal" role="dialog">
  <div class="modal-dialog" >
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header" style="padding:20px 20px;">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4><span class="glyphicon glyphicon-plus"></span> Add source file</h4>
        Add files to be used as source file for VNAs, Noise acquisitions and fit initializations. By checking the permanent button you make your selection persistent across eventual reboot of the client application.
      </div>
        <div class="modal-body" style="padding:40px 50px;">
          <div id = "source-files-list"></div>
          <br>
          <span>
            <label data-toggle="tooltip" title="Name of the source group"> Group </label>
            <input style = "width: 100%; clear: both; margin-right:10px;"
            placeholder="Existing or new group..." type="text" name="group_source" id = 'source-file-group' list="group_list_set" value ='' >
            <datalist id="group_list_set">
              {%for group in source_group_set%}
                <option value="{{group}}">
              {%endfor%}
            </datalist>
          </span>
          <div style = "margin-top:20px;">
          Permanent:

          <input type="checkbox" id = 'permanent_source_checkbox' style = "margin-left:20px"></input>
          </div>

        </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-success btn-default" onclick="add_source_file()"><span class="glyphicon glyphicon-plus"></span> Add</button>
        <button type="submit" class="btn btn-danger btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> Cancel</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="source-manage-modal" role="dialog">
  <div class="modal-dialog" style = "width: auto; max-width: 1060px;">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header" style="padding:20px 20px;">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4><span class="glyphicon glyphicon-tags" style='margin-right:10px'></span> Manage source files</h4>
        Source file management. The table below represent your source file group. In this window you can visualize, remove or check the files.
        The source files are used to initialize fits or measurement.
      </div>
        <div class="modal-body" style="padding:40px 50px;">
          <table class="table" id = "source-file-table">
            <thead>
              <tr>
                <th>Group</th>
                <th>Path</th>
                <th>Kind</th>
                <th>Remove</th>

              </tr>
            </thead>

            <tbody id="source-file-body">
              {%for i in range(source_files|length) %}
              <tr>
                <td word-break:break-all> {{source_files[i]['source_group']}} </td>
                <td word-break:break-all> {{source_files[i]['source_path']}} </td>
                <td > {{source_files[i]['source_kind']}} </td>
                <td >
                  {% if source_files[i]['source_perm'] %}
                   <input type="submit" class="btn btn-link" value = "Remove!" onclick="revome_safe_source(this)" name ="{{source_files[i]['source_path']}}" > </input>
                  {%else%}
                  <input type="submit" class="btn btn-link" value = "Remove" onclick="remove_source(this)" name ="{{source_files[i]['source_path']}}" > </input>
                  {%endif%}
                </td>
              </tr>
              {%endfor%}

            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <div style = "margin-bottom:10px"><i>Note: on deletion of single items, the table may not update correctly. Refreshing the page will display the new source file list.</i></div>
          <button type="submit" class="btn btn-warning btn-default" onclick="remove_tmp_source_file()"><span class="glyphicon glyphicon-remove-sign"></span> Remove non-permanent</button>
          <button type="submit" class="btn btn-info btn-default" onclick="consolidate_source_file()"><span class="glyphicon glyphicon-list"></span> Consolidate files</button>
          <button type="submit" class="btn btn-danger btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> Cancel</button>
        </div>

    </div>
  </div>
</div>

<!-- ANALYSIS PART -->

<!-- Modal -->
<div class="modal fade" id="analysis-modal" role="dialog">
  <div class="modal-dialog" style = "width: auto; max-width: 960px;">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header" style="padding:20px 20px;">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4><span class="glyphicon glyphicon-stats"></span> Available analysis</h4>
        Chose which analysis to perform on selected files and related options. Click analysis name item to expand the options, check the panel to run it.
      </div>
      <div class="modal-body" style="padding:40px 50px;" id = "analysis-modal-configure">

        <!-- Analysis panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <input type="checkbox" id = delay-analysis-chk>
              <a class="toggle" data-toggle="collapse" href="#collapse-delay" style = "margin-left:10px"><b>Delay</b></a>
              <a class="glyphicon glyphicon-question-sign" href="#" data-toggle="tooltip" style = "margin-left:10px"
              title="Use a delay file to generate a delay constant and write it on file"></a>
              <span id = "delay-analysis-header" style = "float:right"></span>
            </h4>
          </div>

          <div id="collapse-delay" class="panel-collapse collapse">
            <div class="panel-body">
              <div id = "delay-analysis-body" style = "margin:10px">
              Delay analysis does not have any oprion at the moment.
              </div>

              <!-- Files display -->
              <div class="panel panel-default", id = 'delay-files'>
                <div class="panel-heading">
                  <h4 class="panel-title">
                    <a class="toggle" data-toggle="collapse" href="#collapse-delay-files"> Files </a>
                  </h4>
                </div>

                <div id="collapse-delay-files" class="panel-collapse collapse">
                  <div class="panel-body", id = "files-delay-analysis-body">
                    <table class="table" style="width:95%">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>Name</th>
                              <th>Folder</th>
                              <th>Overwrite data</th>
                            </tr>
                          </thead>
                          <tbody id = 'delay-analysis-files'></tbody>
                        </table>
                  </div>
                </div>
              </div>
              <!-- end of Files display -->
            </div>
          </div>
        </div>
        <!--end of Analysis panel -->

        <!-- Analysis panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <input type="checkbox" id = vna_simple-analysis-chk>
              <a class="toggle" data-toggle="collapse" href="#collapse-vna_simple" style = "margin-left:10px"><b>VNA analysis</b></a>
              <a class="glyphicon glyphicon-question-sign" href="#" data-toggle="tooltip" style = "margin-left:10px"
              title="Analyze the raw data from a VNA file generating the complex S21 information inside the file"></a>
              <span id = "vna_simple-analysis-header" style = "float:right"></span>
            </h4>
          </div>

          <div id="collapse-vna_simple" class="panel-collapse collapse">
            <div class="panel-body">
              <div id = "vna_simple-analysis-body" style = "margin:10px">
              VNA analysis has no options at the moment.
              </div>

              <!-- Files display -->
              <div class="panel panel-default", id = 'vna_simple-files'>
                <div class="panel-heading">
                  <h4 class="panel-title">
                    <a class="toggle" data-toggle="collapse" href="#collapse-vna_simple-files"> Files </a>
                  </h4>
                </div>

                <div id="collapse-vna_simple-files" class="panel-collapse collapse">
                  <div class="panel-body", id = "files-vna_simple-analysis-body">
                    <table class="table" style="width:95%">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>Name</th>
                              <th>Folder</th>
                              <th>Overwrite data</th>
                            </tr>
                          </thead>
                          <tbody id = 'vna_simple-analysis-files'></tbody>
                        </table>
                  </div>
                </div>
              </div>
              <!-- end of Files display -->
            </div>
          </div>
        </div>
        <!--end of Analysis panel -->

        <!-- Analysis panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <input type="checkbox" id = vna_dynamic-analysis-chk>
              <a class="toggle" data-toggle="collapse" href="#collapse-vna_dynamic" style = "margin-left:10px"><b>Dynamic VNA analysis</b></a>
              <a class="glyphicon glyphicon-question-sign" href="#" data-toggle="tooltip" style = "margin-left:10px"
              title="Interpret each iterations of a VNA measure as a time frame, analyze each frame and saves the data on the file."></a>
              <span id = "vna_dynamic-analysis-header" style = "float:right"></span>
            </h4>
          </div>

          <div id="collapse-vna_dynamic" class="panel-collapse collapse">
            <div class="panel-body">
              <div id = "vna_dynamic-analysis-body" style = "margin:10px">
              Dynamic VNA analysis has no options at the moment.
              </div>

              <!-- Files display -->
              <div class="panel panel-default", id = 'vna_dynamic-files'>
                <div class="panel-heading">
                  <h4 class="panel-title">
                    <a class="toggle" data-toggle="collapse" href="#collapse-vna_dynamic-files"> Files </a>
                  </h4>
                </div>

                <div id="collapse-vna_dynamic-files" class="panel-collapse collapse">
                  <div class="panel-body", id = "files-vna_dynamic-analysis-body">
                    <table class="table" style="width:95%">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>Name</th>
                              <th>Folder</th>
                              <th>Overwrite data</th>
                            </tr>
                          </thead>
                          <tbody id = 'vna_dynamic-analysis-files'></tbody>
                        </table>
                  </div>
                </div>
              </div>
              <!-- end of Files display -->
            </div>
          </div>
        </div>
        <!--end of Analysis panel -->

        <!-- Analysis panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <input type="checkbox" id = fitting-analysis-chk>
              <a class="toggle" data-toggle="collapse" href="#collapse-fitting" style = "margin-left:10px"><b>Fitting</b></a>
              <a class="glyphicon glyphicon-question-sign" href="#" data-toggle="tooltip" style = "margin-left:10px"
              title="Look for resonators and fit the S21 model. If the VNA file has not been analyzed, it will be processed with default options unless specified in this form. Store the results in the file."></a>
              <span id = "fitting-analysis-header" style = "float:right"></span>
            </h4>
          </div>

          <div id="collapse-fitting" class="panel-collapse collapse">
            <div class="panel-body">
              <div id = "fitting-analysis-body" style = "margin:10px">

              <!-- Fitting options -->

              <div>
                <h4>Initialization options
                <button type="submit" class="btn btn-link" onclick="init_test_run()" style = "float:right"><span class="glyphicon glyphicon-fire"></span> Init testrun</button>
                </h4>
                <hr>
              </div>
              <div style="width: 100%; display: table;">
                <div style="display: table-row" >

                  <div style="width: 50%; display: table-cell; padding:10px;">

                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h4 class="panel-title">
                          <input type="checkbox" id = "fit-thr-chk", onclick = "diasble_init_fit_panel(this)">
                          Threshold
                          <a class="glyphicon glyphicon-question-sign" href="#" data-toggle="tooltip" style = "margin-left:10px"
                          title="Set a theshold relative to the maximum absolute value of the S21 derivative (excluding LO glitch) and use the peakutils python package to determine the position of other peaks"></a>
                        </h4>
                      </div>

                      <div class="panel-body" id = "fit-thr-opt">
                        <label data-toggle="tooltip" title="Threshold for peakfinder algorithm."> Threshold </label>
                        <input style = "width: 100%; clear: both; margin-bottom:10px;" type="text" name="threshold" value="0.5", id = 'fit-opt-thr'><br>
                        <label data-toggle="tooltip" title="Decimation factor to apply before initializing the peaks. Won't be inherited by actual fitting."> Smoothing </label>
                        <input style = "width: 100%; clear: both; margin-bottom:10px;" type="text" name="smoothing" value="0", id = 'fit-opt-smooth-thr'><br>
                        <label data-toggle="tooltip" title="Minimum peak distance and fit init range in Hz"> Peak width </label>
                        <input style = "width: 100%; clear: both; margin-bottom:10px;" type="text" name="smoothing" value="20000", id = 'fit-opt-width'><br>

                      </div>
                    </div>

                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h4 class="panel-title">
                          <input type="checkbox" id = "fit-source-chk", onclick = "diasble_init_fit_panel(this)">
                          From file
                          <a class="glyphicon glyphicon-question-sign" href="#" data-toggle="tooltip" style = "margin-left:10px"
                          title="Initialize fitting from an existing VNA file designed as source"></a>
                        </h4>
                      </div>

                      <div class="panel-body" id = "fit-source-opt">
                        <label for="sel_group_fit">Select source group:</label>
                        <select class="form-control" id= "sel_group_fit" onchange ="show_fit_sourcefiles(this)">
                          <option value="" selected="selected">Select a source group...</option>
                          {%for group in source_group_set%}
                            <option value="{{group}}">{{group}}</option>
                          {%endfor%}
                        </select>
                        <label for="sel_source_fit">VNA Measure file</label>
                        <select class="form-control" id= "sel_source_fit">

                        </select>
                      </div>
                    </div>



                  </div>

                  <div style="width: 50%; display: table-cell; padding:10px;">
                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h4 class="panel-title">
                          <input type="checkbox" id = "fit-alt-chk" onclick = "diasble_init_fit_panel(this)">
                          Alt method
                          <a class="glyphicon glyphicon-question-sign" href="#" data-toggle="tooltip" style = "margin-left:10px"
                          title="Use an alternative method for initializing the peaks based on the number of peaks"></a>
                        </h4>
                      </div>

                      <div class="panel-body", id = "fit-alt-opt">
                        <label data-toggle="tooltip" title="Expected number of resonator. The function may find less resonators."> Number of peaks </label>
                        <input style = "width: 100%; clear: both; margin-bottom:10px;" type="text" name="threshold" value="1", id = 'fit-opt-npeaks'><br>
                        <label data-toggle="tooltip" title="Decimation factor to apply before initializing the peaks. Won't be inherited by actual fitting."> Smoothing </label>
                        <input style = "width: 100%; clear: both; margin-bottom:10px;" type="text" name="smoothing" value="0", id = 'fit-opt-smooth-alt'><br>
                        <label data-toggle="tooltip" title="Exclude peaks which have an asymmetry parameter bigger than"> Asymmetry cutoff (eclude >) </label>
                        <input style = "width: 100%; clear: both; margin-bottom:10px;" type="text" name="smoothing" value="10", id = 'fit-opt-A'><br>
                        <label data-toggle="tooltip" title="Exclude peaks which have a Qr parameter smaller than"> Qr cutoff (exclude <) </label>
                        <input style = "width: 100%; clear: both; margin-bottom:10px;" type="text" name="smoothing" value="4e3", id = 'fit-opt-qr'><br>
                        <label data-toggle="tooltip" title="Exclude peaks which have a depth in dB smaller than"> Db depth cutoff (exclude <) </label>
                        <input style = "width: 100%; clear: both; margin-bottom:10px;" type="text" name="smoothing" value="1", id = 'fit-opt-depth'><br>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div>
                <h4>Fitting options</h4>
                <hr>
              </div>

              <!-- END Fitting options -->

              </div>

              <!-- Files display -->
              <div class="panel panel-default", id = 'fitting-files'>
                <div class="panel-heading">
                  <h4 class="panel-title">
                    <a class="toggle" data-toggle="collapse" href="#collapse-fitting-files"> Files </a>
                  </h4>
                </div>

                <div id="collapse-fitting-files" class="panel-collapse collapse">
                  <div class="panel-body", id = "files-fitting-analysis-body">
                    <table class="table" style="width:95%">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>Name</th>
                              <th>Folder</th>
                              <th>Overwrite data</th>
                            </tr>
                          </thead>
                          <tbody id = 'fitting-analysis-files'></tbody>
                        </table>
                  </div>
                </div>
              </div>
              <!-- end of Files display -->
            </div>
          </div>
        </div>
        <!--end of Analysis panel -->

        <!-- Analysis panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <input type="checkbox" id = psd-analysis-chk>
              <a class="toggle" data-toggle="collapse" href="#collapse-psd" style = "margin-left:10px"><b>Power spectrum</b></a>
              <a class="glyphicon glyphicon-question-sign" href="#" data-toggle="tooltip" style = "margin-left:10px"
              title="Calculate the power spectrum of a noise file. Store the result in the file."></a>
              <span id = "psd-analysis-header" style = "float:right"></span>
            </h4>
          </div>

          <div id="collapse-psd" class="panel-collapse collapse">
            <div class="panel-body">
              <div id = "psd-analysis-body" style = "margin:10px">

                <label data-toggle="tooltip" title="How many subsegmant to condider using the Welch method. Default is one and represent normal fft."> Whelch segments </label>
                <input style = "width: 100%; clear: both; margin-bottom:10px;" type="text" name="welch-psd" value="1", id = 'whelch-opt-psd'><br>

                <label data-toggle="tooltip" title="Enable or disable the analysis in dBc. Default is in dBm."> dBc </label>
                <input type="checkbox" id = "dbc-psd-chk">

                <label data-toggle="tooltip" title="Enable or disable the common mode noise reduction. Only works if there is more than one channel available and fallback on normal analysis othewise."> Remove common mode </label>
                <input type="checkbox" id = "commonmode-psd-chk">
              </div>

              <!-- Files display -->
              <div class="panel panel-default", id = 'psd-files'>
                <div class="panel-heading">
                  <h4 class="panel-title">
                    <a class="toggle" data-toggle="collapse" href="#collapse-psd-files"> Files </a>
                  </h4>
                </div>

                <div id="collapse-psd-files" class="panel-collapse collapse">
                  <div class="panel-body", id = "files-psd-analysis-body">
                    <table class="table" style="width:95%">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>Name</th>
                              <th>Folder</th>
                              <th>Overwrite data</th>
                            </tr>
                          </thead>
                          <tbody id = 'psd-analysis-files'></tbody>
                        </table>
                  </div>
                </div>
              </div>
              <!-- end of Files display -->
            </div>
          </div>
        </div>
        <!--end of Analysis panel -->

        <!-- Analysis panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <input type="checkbox" id = qf-analysis-chk>
              <a class="toggle" data-toggle="collapse" href="#collapse-qf" style = "margin-left:10px"><b>Frequency/Q timestreams</b></a>
              <a class="glyphicon glyphicon-question-sign" href="#" data-toggle="tooltip" style = "margin-left:10px"
              title="Calculate the frequency and quality factor timestream using embedded S21 fitting data and the noise I/Q timestream"></a>
              <span id = "qf-analysis-header" style = "float:right"></span>
            </h4>
          </div>

          <div id="collapse-qf" class="panel-collapse collapse">
            <div class="panel-body">
              <div id = "qf-analysis-body" style = "margin:10px">
              F/Q options
              </div>

              <!-- Files display -->
              <div class="panel panel-default", id = 'qf-files'>
                <div class="panel-heading">
                  <h4 class="panel-title">
                    <a class="toggle" data-toggle="collapse" href="#collapse-qf-files"> Files </a>
                  </h4>
                </div>

                <div id="collapse-qf-files" class="panel-collapse collapse">
                  <div class="panel-body", id = "files-qf-analysis-body">
                    <table class="table" style="width:95%">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>Name</th>
                              <th>Folder</th>
                              <th>Overwrite data</th>
                            </tr>
                          </thead>
                          <tbody id = 'qf-analysis-files'></tbody>
                        </table>
                  </div>
                </div>
              </div>
              <!-- end of Files display -->
            </div>
          </div>
        </div>
        <!--end of Analysis panel -->

        <!-- Analysis panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <input type="checkbox" id = qf_psd-analysis-chk>
              <a class="toggle" data-toggle="collapse" href="#collapse-qf_psd" style = "margin-left:10px"><b>Frequency/Q power spectrum</b></a>
              <a class="glyphicon glyphicon-question-sign" href="#" data-toggle="tooltip" style = "margin-left:10px"
              title="Calculate the frequency and quality factor power spectrum using embedded S21 fitting data and the noise I/Q timestream. Store the results on file."></a>
              <span id = "qf_psd-analysis-header" style = "float:right"></span>
            </h4>
          </div>

          <div id="collapse-qf_psd" class="panel-collapse collapse">
            <div class="panel-body">
              <div id = "qf_psd-analysis-body" style = "margin:10px">
              F/Q spec options
              </div>

              <!-- Files display -->
              <div class="panel panel-default", id = 'qf_psd-files'>
                <div class="panel-heading">
                  <h4 class="panel-title">
                    <a class="toggle" data-toggle="collapse" href="#collapse-qf_psd-files"> Files </a>
                  </h4>
                </div>

                <div id="collapse-qf_psd-files" class="panel-collapse collapse">
                  <div class="panel-body", id = "files-qf_psd-analysis-body">
                    <table class="table" style="width:95%">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>Name</th>
                              <th>Folder</th>
                              <th>Overwrite data</th>
                            </tr>
                          </thead>
                          <tbody id = 'qf_psd-analysis-files'></tbody>
                        </table>
                  </div>
                </div>
              </div>
              <!-- end of Files display -->
            </div>
          </div>
        </div>
        <!--end of Analysis panel -->

        <!-- Analysis panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <input type="checkbox" id = calibrated_psd-analysis-chk>
              <a class="toggle" data-toggle="collapse" href="#collapse-calibrated_psd" style = "margin-left:10px"><b>Calibrated power spectrum</b></a>
              <a class="glyphicon glyphicon-question-sign" href="#" data-toggle="tooltip" style = "margin-left:10px"
              title="Calculate the power spectrum using the Q/F noise data and the embedded calibration constant. Store the results on file."></a>
              <span id = "calibrated_psd-analysis-header" style = "float:right"></span>
            </h4>
          </div>

          <div id="collapse-calibrated_psd" class="panel-collapse collapse">
            <div class="panel-body">
              <div id = "calibrated_psd-analysis-body" style = "margin:10px">
              Calibrated spec options
              </div>

              <!-- Files display -->
              <div class="panel panel-default", id = 'calibrated_psd-files'>
                <div class="panel-heading">
                  <h4 class="panel-title">
                    <a class="toggle" data-toggle="collapse" href="#collapse-calibrated_psd-files"> Files </a>
                  </h4>
                </div>

                <div id="collapse-calibrated_psd-files" class="panel-collapse collapse">
                  <div class="panel-body", id = "files-calibrated_psd-analysis-body">
                    <table class="table" style="width:95%">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>Name</th>
                              <th>Folder</th>
                              <th>Overwrite data</th>
                            </tr>
                          </thead>
                          <tbody id = 'calibrated_psd-analysis-files'></tbody>
                        </table>
                  </div>
                </div>
              </div>
              <!-- end of Files display -->
            </div>
          </div>
        </div>
        <!--end of Analysis panel -->

        <!-- Analysis panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <input type="checkbox" id = pair_subtraction-analysis-chk>
              <a class="toggle" data-toggle="collapse" href="#collapse-pair_subtraction" style = "margin-left:10px"><b>Pair differencing</b></a>
              <a class="glyphicon glyphicon-question-sign" href="#" data-toggle="tooltip" style = "margin-left:10px"
              title="Calculate the differential power spectrum using the calibrated noise data and the embedded pair information. Store the results on file."></a>
              <span id = "pair_subtraction-analysis-header" style = "float:right"></span>
            </h4>
          </div>

          <div id="collapse-pair_subtraction" class="panel-collapse collapse">
            <div class="panel-body">
              <div id = "pair_subtraction-analysis-body" style = "margin:10px">
              Pair options
              </div>

              <!-- Files display -->
              <div class="panel panel-default", id = 'pair_subtraction-files'>
                <div class="panel-heading">
                  <h4 class="panel-title">
                    <a class="toggle" data-toggle="collapse" href="#collapse-pair_subtraction-files"> Files </a>
                  </h4>
                </div>

                <div id="collapse-pair_subtraction-files" class="panel-collapse collapse">
                  <div class="panel-body", id = "files-pair_subtraction-analysis-body">
                    <table class="table" style="width:95%">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>Name</th>
                              <th>Folder</th>
                              <th>Overwrite data</th>
                            </tr>
                          </thead>
                          <tbody id = 'pair_subtraction-analysis-files'></tbody>
                        </table>
                  </div>
                </div>
              </div>
              <!-- end of Files display -->
            </div>
          </div>
        </div>
        <!--end of Analysis panel -->

        <!-- Analysis panel -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <input type="checkbox" id = calibration-analysis-chk>
              <a class="toggle" data-toggle="collapse" href="#collapse-calibration" style = "margin-left:10px"><b>Calibration</b></a>
              <a class="glyphicon glyphicon-question-sign" href="#" data-toggle="tooltip" style = "margin-left:10px"
              title="Use a noise file to generate a calibration constant and write it on file"></a>
              <span id = "calibration-analysis-header" style = "float:right"></span>
            </h4>
          </div>

          <div id="collapse-calibration" class="panel-collapse collapse">
            <div class="panel-body">
              <div id = "calibration-analysis-body" style = "margin:10px">
              Calibration options
              </div>

              <!-- Files display -->
              <div class="panel panel-default", id = 'calibration-files'>
                <div class="panel-heading">
                  <h4 class="panel-title">
                    <a class="toggle" data-toggle="collapse" href="#collapse-calibration-files"> Files </a>
                  </h4>
                </div>

                <div id="collapse-calibration-files" class="panel-collapse collapse">
                  <div class="panel-body", id = "files-calibration-analysis-body">
                    <table class="table" style="width:95%">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>Name</th>
                              <th>Folder</th>
                              <th>Overwrite data</th>
                            </tr>
                          </thead>
                          <tbody id = 'calibration-analysis-files'></tbody>
                        </table>
                  </div>
                </div>
              </div>
              <!-- end of Files display -->
            </div>
          </div>
        </div>
        <!--end of Analysis panel -->

        <div class="panel panel-default", id = 'exclusion-files'>
          <div class="panel-heading">
            <h4 class="panel-title">
              <a class="toggle" data-toggle="collapse" href="#collapse-exclusion-files"> <b>Excluded files</b> </a>
              <a class="glyphicon glyphicon-question-sign" href="#" data-toggle="tooltip" style = "margin-left:10px"
              title="Files that cannot be analyzed"></a>
              <span id = "exclusion-analysis-header" style = "float:right"></span>
            </h4>
          </div>

          <div id="collapse-exclusion-files" class="panel-collapse collapse">
            <div class="panel-body", id = "files-exclusion-analysis-body">
              <table class="table" style="width:95%">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Folder</th>
                        <th>Reason</th>
                      </tr>
                    </thead>
                    <tbody id = 'exclusion-analysis-files'></tbody>
                  </table>
            </div>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-success btn-default" onclick="enqueue_all_jobs()"><span class="glyphicon glyphicon-fire"></span> Run</button>
        <button type="submit" class="btn btn-danger btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> Cancel</button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src={{ url_for('static', filename = 'js/explore.js') }}></script>

{% endblock %}
